name: Deploy Streamlit App

on:
  push:
    branches: [ main ]
    paths:
      - 'inventory-manager/**'
      - '.github/workflows/streamlit-deploy.yml'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          cd inventory-manager
          pip install -r requirements.txt
          # Add the missing YouTube API dependency
          pip install google-api-python-client
      
      - name: Test imports
        run: |
          cd inventory-manager/src
          python -c "import streamlit as st; print('Streamlit version:', st.__version__)"
          python -c "import database_manager; print('Database manager imports successfully')"
          python -c "from handlers.discogs_handler import DiscogsHandler; print('Discogs handler imports successfully')"
          python -c "import streamlit_app; print('Main app imports successfully')"