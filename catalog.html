<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Record Gallery - PigStyle Records</title>
    <link rel='stylesheet' href='catalog_style.css'>
</head>
<body>
    <header>
        <a href='index.html'><img src='images/pigstyle_text.png' alt='PigStyle' style='height:60px; vertical-align:middle;'></a>
    </header>
    <h1>🎵 Record Gallery</h1>
    <div class='search-container'>
        <input type='text' id='searchBox' placeholder='Search artist or record...'>
    </div>
    <div class='gallery-popup' id='gallery'>
        <div id='loading'>
            <div class="loading-dots">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <p>Loading records...</p>
        </div>
    </div>

    <script>
        // Store all records globally for search functionality
        let allRecords = [];

        // Load data from gallery-data.json
        async function loadGalleryData() {
            try {
                const response = await fetch('gallery-data.json');
                allRecords = await response.json();
                displayRecords(allRecords);
            } catch (error) {
                console.error('Error loading gallery data:', error);
                document.getElementById('gallery').innerHTML = '<div>Error loading records. Please try again later.</div>';
            }
        }

        // Display records in the gallery
        function displayRecords(records) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = ''; // Clear loading message

            records.forEach(record => {
                const card = document.createElement('div');
                card.className = 'card highlight';
                card.setAttribute('data-info', `${record.artist} ${record.title}`.toLowerCase());
                
                card.innerHTML = `
                    <img src="${record.image}" alt="${record.title}" onerror="this.src='images/default-record.jpg'">
                    <div class="card-info">
                        <h3>${escapeHtml(record.title)}</h3>
                        <p>${escapeHtml(record.artist)}</p>
                        <p class="price">${record.price}</p>
                        <p class="genre">${escapeHtml(record.genre)}</p>
                    </div>
                `;
                
                gallery.appendChild(card);
            });

            // Initialize search functionality
            initializeSearch();
        }

        // Initialize search functionality
        function initializeSearch() {
            const searchBox = document.getElementById('searchBox');
            
            searchBox.addEventListener('input', () => {
                const term = searchBox.value.toLowerCase().trim();
                
                if (!term) {
                    // If search is empty, show all records
                    displayRecords(allRecords);
                } else {
                    // Filter records based on search term
                    const filteredRecords = allRecords.filter(record => {
                        const searchString = `${record.artist} ${record.title}`.toLowerCase();
                        return searchString.includes(term);
                    });
                    
                    // Display filtered records
                    displayFilteredRecords(filteredRecords);
                }
            });
        }

        // Display filtered records with proper highlighting
        function displayFilteredRecords(filteredRecords) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = ''; // Clear current gallery

            // Create a map of filtered records for quick lookup
            const filteredMap = new Map();
            filteredRecords.forEach(record => {
                filteredMap.set(`${record.artist} ${record.title}`.toLowerCase(), record);
            });

            // Display all records, but highlight only the filtered ones
            allRecords.forEach(record => {
                const card = document.createElement('div');
                const recordKey = `${record.artist} ${record.title}`.toLowerCase();
                const isHighlighted = filteredMap.has(recordKey);
                
                card.className = isHighlighted ? 'card highlight' : 'card not-highlight';
                card.setAttribute('data-info', recordKey);
                
                card.innerHTML = `
                    <img src="${record.image}" alt="${record.title}" onerror="this.src='images/default-record.jpg'">
                    <div class="card-info">
                        <h3>${escapeHtml(record.title)}</h3>
                        <p>${escapeHtml(record.artist)}</p>
                        <p class="price">${record.price}</p>
                        <p class="genre">${escapeHtml(record.genre)}</p>
                    </div>
                `;
                
                gallery.appendChild(card);
            });
        }

        // Helper function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Load the gallery data when page loads
        loadGalleryData();
    </script>
</body>
</html>