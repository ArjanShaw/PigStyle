<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Record Gallery - PigStyle Records</title>
    <link rel='stylesheet' href='catalog_style.css'>
</head>
<body>
    <header>
        <a href='index.html'><img src='images/pigstyle_text.png' alt='PigStyle' style='height:60px; vertical-align:middle;'></a>
    </header>
    <h1>🎵 Record Gallery</h1>
    <div class='search-container'>
        <input type='text' id='searchBox' placeholder='Search artist or record...'>
    </div>
    <div class='gallery-popup' id='gallery'>
        <div id='loading'>
            <div class="loading-dots">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <p>Loading records...</p>
        </div>
    </div>

    <script>
        // Store all records globally for search functionality
        let allRecords = [];

        // Load data from gallery-data.json
        async function loadGalleryData() {
            try {
                const response = await fetch('gallery-data.json');
                allRecords = await response.json();
                displayRecords(allRecords);
            } catch (error) {
                console.error('Error loading gallery data:', error);
                document.getElementById('gallery').innerHTML = '<div>Error loading records. Please try again later.</div>';
            }
        }

        // Display records in the gallery
        function displayRecords(records) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = ''; // Clear loading message

            records.forEach(record => {
                const card = createCardElement(record, true);
                gallery.appendChild(card);
            });

            // Initialize search functionality
            initializeSearch();
        }

        // Create a card element
        function createCardElement(record, isHighlighted) {
            const card = document.createElement('div');
            card.className = isHighlighted ? 'card highlight' : 'card not-highlight';
            card.setAttribute('data-artist', record.artist.toLowerCase());
            card.setAttribute('data-title', record.title.toLowerCase());
            
            card.innerHTML = `
                <img src="${record.image}" alt="${record.title}" onerror="this.src='images/default-record.jpg'">
                <div class="card-info">
                    <h3>${escapeHtml(record.title)}</h3>
                    <p>${escapeHtml(record.artist)}</p>
                    <p class="price">${record.price}</p>
                    <p class="genre">${escapeHtml(record.genre)}</p>
                </div>
            `;
            
            return card;
        }

        // Initialize search functionality
        function initializeSearch() {
            const searchBox = document.getElementById('searchBox');
            const gallery = document.getElementById('gallery');
            
            searchBox.addEventListener('input', () => {
                const term = searchBox.value.toLowerCase().trim();
                const cards = Array.from(gallery.querySelectorAll('.card'));
                
                if (!term) {
                    // If search is empty, show all cards
                    cards.forEach(card => {
                        card.classList.remove('not-highlight');
                        card.classList.add('highlight');
                    });
                    // Scroll to top when search is cleared
                    gallery.scrollTop = 0;
                } else {
                    let firstMatch = null;
                    
                    // Update visibility for all cards
                    cards.forEach(card => {
                        const artist = card.getAttribute('data-artist');
                        const title = card.getAttribute('data-title');
                        const matches = artist.includes(term) || title.includes(term);
                        
                        if (matches) {
                            card.classList.remove('not-highlight');
                            card.classList.add('highlight');
                            // Store reference to first matching card
                            if (!firstMatch) {
                                firstMatch = card;
                            }
                        } else {
                            card.classList.remove('highlight');
                            card.classList.add('not-highlight');
                        }
                    });
                    
                    // Scroll to first matching card if found
                    if (firstMatch) {
                        firstMatch.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    }
                }
            });
        }

        // Helper function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Load the gallery data when page loads
        loadGalleryData();
    </script>
</body>
</html>